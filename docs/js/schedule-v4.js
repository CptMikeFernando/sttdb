const LSU_FOOTBALL_2026 = [
  { date: '2026-09-05', opponent: 'at Clemson', time: 'TBD' },
  { date: '2026-09-12', opponent: 'Louisiana Tech', time: 'TBD' },
  { date: '2026-09-19', opponent: 'Ole Miss', time: 'TBD' },
  { date: '2026-09-26', opponent: 'Texas A&M', time: 'TBD' },
  { date: '2026-10-03', opponent: 'McNeese', time: 'TBD' },
  { date: '2026-10-10', opponent: 'at Kentucky', time: 'TBD' },
  { date: '2026-10-17', opponent: 'Mississippi State', time: 'TBD' },
  { date: '2026-10-24', opponent: 'at Auburn', time: 'TBD' },
  { date: '2026-11-07', opponent: 'Alabama', time: 'TBD' },
  { date: '2026-11-14', opponent: 'Texas', time: 'TBD' },
  { date: '2026-11-21', opponent: 'at Tennessee', time: 'TBD' },
  { date: '2026-11-28', opponent: 'Arkansas', time: 'TBD' }
];

const LSU_BASEBALL_2026 = [
  { date: '2026-02-13', opponent: 'Milwaukee', time: 'TBD' },
  { date: '2026-02-14', opponent: 'Milwaukee', time: 'TBD' },
  { date: '2026-02-15', opponent: 'Milwaukee', time: 'TBD' },
  { date: '2026-02-16', opponent: 'Kent State', time: 'TBD' },
  { date: '2026-02-18', opponent: 'Nicholls', time: 'TBD' },
  { date: '2026-02-20', opponent: 'vs Indiana', time: 'TBD' },
  { date: '2026-02-21', opponent: 'vs Notre Dame', time: 'TBD' },
  { date: '2026-02-22', opponent: 'vs UCF', time: 'TBD' },
  { date: '2026-02-24', opponent: 'McNeese', time: 'TBD' },
  { date: '2026-02-27', opponent: 'Dartmouth', time: 'TBD' },
  { date: '2026-02-28', opponent: 'Northeastern', time: 'TBD' },
  { date: '2026-03-01', opponent: 'Dartmouth', time: 'TBD' },
  { date: '2026-03-02', opponent: 'Northeastern', time: 'TBD' },
  { date: '2026-03-04', opponent: 'at UL Lafayette', time: 'TBD' },
  { date: '2026-03-06', opponent: 'Sacramento St', time: 'TBD' },
  { date: '2026-03-07', opponent: 'Sacramento St', time: 'TBD' },
  { date: '2026-03-08', opponent: 'Sacramento St', time: 'TBD' },
  { date: '2026-03-10', opponent: 'Creighton', time: 'TBD' },
  { date: '2026-03-13', opponent: 'at Vanderbilt', time: 'TBD' },
  { date: '2026-03-14', opponent: 'at Vanderbilt', time: 'TBD' },
  { date: '2026-03-15', opponent: 'at Vanderbilt', time: 'TBD' },
  { date: '2026-03-17', opponent: 'Grambling St', time: 'TBD' },
  { date: '2026-03-20', opponent: 'Oklahoma', time: 'TBD' },
  { date: '2026-03-21', opponent: 'Oklahoma', time: 'TBD' },
  { date: '2026-03-22', opponent: 'Oklahoma', time: 'TBD' },
  { date: '2026-03-24', opponent: 'Louisiana Tech', time: 'TBD' },
  { date: '2026-03-27', opponent: 'Kentucky', time: 'TBD' },
  { date: '2026-03-28', opponent: 'Kentucky', time: 'TBD' },
  { date: '2026-03-29', opponent: 'Kentucky', time: 'TBD' },
  { date: '2026-03-31', opponent: 'Southern', time: 'TBD' },
  { date: '2026-04-03', opponent: 'at Tennessee', time: 'TBD' },
  { date: '2026-04-04', opponent: 'at Tennessee', time: 'TBD' },
  { date: '2026-04-05', opponent: 'at Tennessee', time: 'TBD' },
  { date: '2026-04-07', opponent: 'Bethune-Cookman', time: 'TBD' },
  { date: '2026-04-10', opponent: 'at Ole Miss', time: 'TBD' },
  { date: '2026-04-11', opponent: 'at Ole Miss', time: 'TBD' },
  { date: '2026-04-12', opponent: 'at Ole Miss', time: 'TBD' },
  { date: '2026-04-14', opponent: 'Northwestern St', time: 'TBD' },
  { date: '2026-04-17', opponent: 'Texas A&M', time: 'TBD' },
  { date: '2026-04-18', opponent: 'Texas A&M', time: 'TBD' },
  { date: '2026-04-19', opponent: 'Texas A&M', time: 'TBD' },
  { date: '2026-04-21', opponent: 'New Orleans', time: 'TBD' },
  { date: '2026-04-24', opponent: 'at Miss State', time: 'TBD' },
  { date: '2026-04-25', opponent: 'at Miss State', time: 'TBD' },
  { date: '2026-04-26', opponent: 'at Miss State', time: 'TBD' },
  { date: '2026-04-28', opponent: 'SE Louisiana', time: 'TBD' },
  { date: '2026-05-01', opponent: 'at Georgia', time: 'TBD' },
  { date: '2026-05-02', opponent: 'at Georgia', time: 'TBD' },
  { date: '2026-05-03', opponent: 'at Georgia', time: 'TBD' },
  { date: '2026-05-08', opponent: 'South Carolina', time: 'TBD' },
  { date: '2026-05-09', opponent: 'South Carolina', time: 'TBD' },
  { date: '2026-05-10', opponent: 'South Carolina', time: 'TBD' },
  { date: '2026-05-15', opponent: 'Florida', time: 'TBD' },
  { date: '2026-05-16', opponent: 'Florida', time: 'TBD' },
  { date: '2026-05-17', opponent: 'Florida', time: 'TBD' }
];

const LSU_MENS_BASKETBALL_2025_26 = [
  { date: '2025-11-04', opponent: 'ULM', time: '7:00 PM', result: 'W 102-60' },
  { date: '2025-11-08', opponent: 'at UCF', time: '2:00 PM', result: 'W 89-70' },
  { date: '2025-11-12', opponent: 'Charleston So', time: '7:00 PM', result: 'W 96-33' },
  { date: '2025-11-17', opponent: 'vs UCF', time: '6:00 PM', result: 'W 93-68' },
  { date: '2025-11-18', opponent: 'vs Wichita St', time: '8:30 PM', result: 'L 63-70' },
  { date: '2025-11-21', opponent: 'North Texas', time: '8:00 PM', result: 'W 73-59' },
  { date: '2025-11-25', opponent: 'vs Maryland', time: '4:30 PM', result: 'W 69-63' },
  { date: '2025-11-26', opponent: 'vs St. Johns', time: 'TBD', result: 'L 76-78' },
  { date: '2025-12-03', opponent: 'Tulane', time: '8:00 PM', result: 'W 94-59' },
  { date: '2025-12-07', opponent: 'SMU', time: '1:00 PM', result: 'W 73-51' },
  { date: '2025-12-14', opponent: 'Southern Miss', time: '4:00 PM', result: 'W 97-60' },
  { date: '2025-12-21', opponent: 'Pittsburgh', time: '12:00 PM', result: 'W 95-80' },
  { date: '2025-12-29', opponent: 'Nicholls', time: '1:00 PM', result: 'W 91-44' },
  { date: '2026-01-04', opponent: 'at Texas A&M', time: '1:00 PM', result: 'L 72-88' },
  { date: '2026-01-07', opponent: 'Missouri', time: '9:00 PM', result: 'L 82-83' },
  { date: '2026-01-11', opponent: 'at Vanderbilt', time: '1:00 PM', result: 'L 74-84' },
  { date: '2026-01-14', opponent: 'Kentucky', time: '6:00 PM' },
  { date: '2026-01-17', opponent: 'Missouri', time: '2:30 PM' },
  { date: '2026-01-20', opponent: 'at Florida', time: '6:00 PM' },
  { date: '2026-01-24', opponent: 'at Arkansas', time: '7:30 PM' },
  { date: '2026-01-28', opponent: 'Mississippi State', time: '6:00 PM' },
  { date: '2026-01-31', opponent: 'at South Carolina', time: '5:00 PM' },
  { date: '2026-02-07', opponent: 'Georgia', time: '5:00 PM' },
  { date: '2026-02-17', opponent: 'at Texas', time: '8:00 PM' },
  { date: '2026-02-21', opponent: 'Alabama', time: '5:00 PM' },
  { date: '2026-02-25', opponent: 'at Ole Miss', time: '8:00 PM' },
  { date: '2026-02-28', opponent: 'Oklahoma', time: '5:00 PM' }
];

const LSU_WOMENS_BASKETBALL_2025_26 = [
  { date: '2025-11-04', opponent: 'Eastern Kentucky', time: '7:00 PM', result: 'W 95-44' },
  { date: '2025-11-10', opponent: 'at Clemson', time: '6:00 PM', result: 'W 77-53' },
  { date: '2025-11-14', opponent: 'Southern', time: '7:00 PM', result: 'W 80-42' },
  { date: '2025-11-17', opponent: 'Murray State', time: '11:00 AM', result: 'W 119-59' },
  { date: '2025-11-21', opponent: 'UL Monroe', time: '7:00 PM', result: 'W 100-53' },
  { date: '2025-11-28', opponent: 'vs UCLA', time: '1:30 PM', result: 'L 60-75' },
  { date: '2025-11-29', opponent: 'vs Oregon', time: 'TBD', result: 'W 69-65' },
  { date: '2025-12-04', opponent: 'Grambling State', time: '7:00 PM', result: 'W 93-49' },
  { date: '2025-12-08', opponent: 'at Stanford', time: '5:00 PM', result: 'W 79-72' },
  { date: '2025-12-14', opponent: 'Tulane', time: '1:00 PM', result: 'W 66-55' },
  { date: '2025-12-17', opponent: 'Northwestern St', time: '7:00 PM', result: 'W 93-47' },
  { date: '2025-12-21', opponent: 'SE Louisiana', time: '2:00 PM', result: 'W 95-32' },
  { date: '2025-12-29', opponent: 'Coppin State', time: '1:00 PM', result: 'W 111-48' },
  { date: '2026-01-02', opponent: 'at Vanderbilt', time: '6:00 PM', result: 'L 63-68' },
  { date: '2026-01-05', opponent: 'Kentucky', time: '3:00 PM', result: 'W 92-62' },
  { date: '2026-01-11', opponent: 'Texas', time: '1:00 PM', result: 'W 70-65' },
  { date: '2026-01-18', opponent: 'at Oklahoma', time: '2:00 PM' },
  { date: '2026-01-22', opponent: 'at Texas A&M', time: '8:00 PM' },
  { date: '2026-01-26', opponent: 'Florida', time: '7:00 PM' },
  { date: '2026-01-29', opponent: 'Arkansas', time: '7:00 PM' },
  { date: '2026-02-01', opponent: 'Alabama', time: '11:00 AM' },
  { date: '2026-02-05', opponent: 'at Texas', time: '8:00 PM' },
  { date: '2026-02-08', opponent: 'at Auburn', time: '1:00 PM' },
  { date: '2026-02-14', opponent: 'South Carolina', time: '7:30 PM' },
  { date: '2026-02-19', opponent: 'at Ole Miss', time: '8:00 PM' },
  { date: '2026-02-22', opponent: 'Missouri', time: '3:00 PM' },
  { date: '2026-02-26', opponent: 'at Tennessee', time: '5:00 PM' }
];

async function fetchGameResult(gameDate, sport) {
  try {
    const dateStr = gameDate.replace(/-/g, '');
    let url;
    
    if (sport === 'football') {
      url = `https://site.api.espn.com/apis/site/v2/sports/football/college-football/scoreboard?dates=${dateStr}`;
    } else if (sport === 'baseball') {
      url = `https://site.api.espn.com/apis/site/v2/sports/baseball/college-baseball/scoreboard?dates=${dateStr}`;
    } else if (sport === 'mens-basketball') {
      url = `https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/scoreboard?dates=${dateStr}`;
    } else if (sport === 'womens-basketball') {
      url = `https://site.api.espn.com/apis/site/v2/sports/basketball/womens-college-basketball/scoreboard?dates=${dateStr}`;
    }
    
    const response = await fetch(url);
    if (!response.ok) return null;
    const data = await response.json();
    
    for (const event of data.events || []) {
      const competitors = event.competitions?.[0]?.competitors || [];
      const lsuTeam = competitors.find(c => c.team?.abbreviation === 'LSU' || c.team?.displayName?.includes('LSU'));
      
      if (lsuTeam) {
        const opponent = competitors.find(c => c !== lsuTeam);
        const lsuScore = parseInt(lsuTeam.score) || 0;
        const oppScore = parseInt(opponent?.score) || 0;
        const status = event.status?.type?.completed;
        const isInProgress = event.status?.type?.state === 'in';
        
        return {
          completed: status,
          inProgress: isInProgress,
          lsuScore: lsuScore,
          oppScore: oppScore,
          lsuWon: lsuScore > oppScore,
          statusText: event.status?.type?.shortDetail || ''
        };
      }
    }
    return null;
  } catch (e) {
    console.log('Error fetching game result:', e);
    return null;
  }
}

function formatScheduleDate(dateStr) {
  const date = new Date(dateStr + 'T12:00:00');
  return `${date.getMonth() + 1}/${date.getDate()}`;
}

function isGameDayOrPast(dateStr) {
  const gameDate = new Date(dateStr + 'T00:00:00');
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  return gameDate <= today;
}

function parseHardcodedResult(resultStr) {
  if (!resultStr) return null;
  const match = resultStr.match(/([WL])\s+(\d+)-(\d+)/);
  if (match) {
    const won = match[1] === 'W';
    const lsuScore = parseInt(match[2]);
    const oppScore = parseInt(match[3]);
    return {
      completed: true,
      lsuWon: won,
      lsuScore: lsuScore,
      oppScore: oppScore
    };
  }
  return null;
}

async function renderSchedule(schedule, containerId, sport) {
  const container = document.getElementById(containerId);
  if (!container) return;
  
  let html = '';
  
  for (const game of schedule) {
    const formattedDate = formatScheduleDate(game.date);
    let resultCell = '';
    let resultClass = '';
    
    if (game.result) {
      const parsed = parseHardcodedResult(game.result);
      if (parsed) {
        const letter = parsed.lsuWon ? 'W' : 'L';
        resultClass = parsed.lsuWon ? 'win' : 'loss';
        resultCell = `<span class="result-letter ${resultClass}">${letter}</span> ${parsed.lsuScore}-${parsed.oppScore}`;
      }
    } else if (isGameDayOrPast(game.date)) {
      const result = await fetchGameResult(game.date, sport);
      if (result && result.completed) {
        const letter = result.lsuWon ? 'W' : 'L';
        resultClass = result.lsuWon ? 'win' : 'loss';
        resultCell = `<span class="result-letter ${resultClass}">${letter}</span> ${result.lsuScore}-${result.oppScore}`;
      } else if (result && result.inProgress) {
        resultCell = `<span class="result-live">LIVE</span> ${result.lsuScore}-${result.oppScore}`;
      } else {
        resultCell = `<span class="result-tbd">TBD</span>`;
      }
    } else {
      const gameTime = game.time !== 'TBD' ? game.time : 'TBD';
      resultCell = `<span class="result-tbd">${gameTime}</span>`;
    }
    
    html += `
      <div class="schedule-row">
        <div class="schedule-date">${formattedDate}</div>
        <div class="schedule-opponent">${game.opponent}</div>
        <div class="schedule-result ${resultClass}">${resultCell}</div>
      </div>
    `;
  }
  
  container.innerHTML = html;
}

function initSchedules() {
  renderSchedule(LSU_FOOTBALL_2026, 'football-schedule-content', 'football');
  renderSchedule(LSU_BASEBALL_2026, 'baseball-schedule-content', 'baseball');
  renderSchedule(LSU_MENS_BASKETBALL_2025_26, 'mens-basketball-schedule-content', 'mens-basketball');
  renderSchedule(LSU_WOMENS_BASKETBALL_2025_26, 'womens-basketball-schedule-content', 'womens-basketball');
  
  setInterval(() => {
    renderSchedule(LSU_FOOTBALL_2026, 'football-schedule-content', 'football');
    renderSchedule(LSU_BASEBALL_2026, 'baseball-schedule-content', 'baseball');
    renderSchedule(LSU_MENS_BASKETBALL_2025_26, 'mens-basketball-schedule-content', 'mens-basketball');
    renderSchedule(LSU_WOMENS_BASKETBALL_2025_26, 'womens-basketball-schedule-content', 'womens-basketball');
  }, 300000);
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initSchedules);
} else {
  initSchedules();
}
